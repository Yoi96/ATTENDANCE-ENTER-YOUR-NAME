<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <title>Name Submission</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/supabase.js"></script>
</head>
<body>
 <div id="wrap">
     <div id="main_body">
         <div id="fullname">
             <img src="images/logos.png" height="70em">
             <div id="fullname_title">Attendance<br>Enter Your Name</div>

             <div id="name">
                 <label for="firstName">First Name:</label>
                 <input type="text" id="firstName" placeholder="Type your first name...">
             </div>

             <div id="name">
                 <label for="middleName">Middle Name:</label>
                 <input type="text" id="middleName" placeholder="Middle Name">
             </div>

             <div id="name">
                 <label for="lastName">Last Name:</label>
                 <input type="text" id="lastName" placeholder="Type your last name...">
             </div>

             <div id="name">
                 <label for="osisNumber">OSIS Number/Student ID:</label>
                 <input type="text" id="osisNumber" placeholder="OSIS Number">
             </div>

             <div id="name">
                 <label>Your School:</label>
                 <div id="schoolCheckboxes">
                     <label><input type="checkbox" value="Mott Hall High School (Harlem)"> Mott Hall High School (Harlem)</label><br>
                     <label><input type="checkbox" value="Eagle Academy for Young Men of Harlem"> Eagle Academy for Young Men of Harlem</label><br>
                     <label><input type="checkbox" value="Urban Assembly School of Global Commerce"> Urban Assembly School of Global Commerce</label><br>
                     <label><input type="checkbox" value="A. Philip Randolph"> A. Philip Randolph</label>
                 </div>
             </div>

             <div id="name">
                 <button id="submitButton">Submit</button>
             </div>

             <div id="title2">Your name is:</div>
             <span>(You can click the button to submit before checking that your name is correct)</span>
             <div id="displayName">&nbsp;</div>
         </div>

         <div id="fullname2">
             <div id="title3">Submitted Names:</div>
             <ul id="submittedNamesList"></ul>
             <button id="saveButton">Save Submitted Names as Text File</button>
             <button id="emailButton"><a href="mailto:xiaoyiliu96xyl@gmail.com">Save Submitted Names as Email</a></button>
         </div>
     </div>
 </div>

 <script>
    
const supabaseUrl = 'https://fejedqaukushmsneqneb.supabase.co';
const supabaseKey = String.fromEnvironment('SUPABASE_KEY');
 const supabase = supabase.createClient(supabaseUrl, supabaseKey);

Future<void> main() async {
  await Supabase.initialize(url: supabaseUrl, anonKey: supabaseKey);
  runApp(MyApp());
}
   

    const firstNameInput = document.getElementById('firstName');
    const middleNameInput = document.getElementById('middleName');
    const lastNameInput = document.getElementById('lastName');
    const osisNumberInput = document.getElementById('osisNumber');
    const schoolCheckboxes = document.querySelectorAll('#schoolCheckboxes input[type="checkbox"]');
    const displayNameDiv = document.getElementById('displayName');
    const submitButton = document.getElementById('submitButton');

    // Submit name functionality
    submitButton.addEventListener('click', async function() {
        const firstName = firstNameInput.value.trim();
        const middleName = middleNameInput.value.trim();
        const lastName = lastNameInput.value.trim();
        const osisNumber = osisNumberInput.value.trim();
        const selectedSchools = Array.from(schoolCheckboxes)
            .filter(checkbox => checkbox.checked)
            .map(checkbox => checkbox.value);

        console.log({ firstName, middleName, lastName, osisNumber, selectedSchools }); // Log inputs

        // Validate inputs
        if (firstName === '' || lastName === '' || osisNumber === '' || selectedSchools.length === 0) {
            alert('Please fill in all fields and select at least one school.');
            return;
        }

        // Insert data into Supabase
        const { data, error } = await supabase
            .from('students') // Using the correct table name
            .insert([
                { 
                    first_name: firstName,
                    middle_name: middleName,
                    last_name: lastName,
                    osis_number: osisNumber,
                    schools: selectedSchools.join(', ')
                }
            ]);

        console.log('Supabase response:', { data, error }); // Log response

        if (error) {
            console.error('Error saving to Supabase:', error);
            alert('Failed to save data.');
        } else {
            alert('User saved to Supabase!');
            // Clear the input fields
            firstNameInput.value = '';
            middleNameInput.value = '';
            lastNameInput.value = '';
            osisNumberInput.value = '';
            schoolCheckboxes.forEach(checkbox => checkbox.checked = false);
            displayNameDiv.textContent = '';
        }
    });
</script>
</body>
</html>
